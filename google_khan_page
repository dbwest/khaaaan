require 'watir-webdriver'
require 'page-object'
require 'sinatra'
require 'json'

class GoogleKhanPage
  include PageObject


    @s_string = "khan"

  form(:google_form, :id => 'gbqf')
      div(:result_stats, :id => 'resultStats' )
end

class GoogleResultsPage
    include PageObject

end

class KhanStats
   
    def initialize
        @browser = Watir::Browser.new
        @google_page = GoogleKhanPage.new @browser
    end

    def khan_string num
        @s_string = "Kh#{'a' * num}n"
    end

    def khan_count num
        @google_page.navigate_to("http://google.com/#q=" + khan_string(num))
        results = @google_page.result_stats
        results.split(" ")[1].delete(",").to_i
    end

    def close
        @browser.close
    end
end

    
get '/khan' do
    content_type :json
    khan_stats = KhanStats.new
    khan_array = []
    khan_array << ["KHANS", "SHATNERS"]

    5.times do |i|
        khan_array << [(i+1), khan_stats.khan_count(i+1)]

    end
    khan_stats.close
    khan_array.t
end


